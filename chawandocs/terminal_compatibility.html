<!DOCTYPE html>
<!-- saved from url=(0040)https://chawan.net/doc/cha/terminal.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>
Chawan: Chawan terminal compatibility
</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="https://chawan.net/favicon.ico">
<style>
    /* layout */
*           { box-sizing: border-box; border-width: 0 }
body            { display: flex; flex-direction: column }
body            { min-height: 100vh; margin: 0 auto }
header          { max-width: 60ch; display: flex; flex-wrap: wrap }
header a        { display: block; flex: 1; font-size: larger }
main            { width: 72ch; margin: 1em auto }
@media(width<72ch){main { width: 100% }                        }
footer          { float: right; font-style: italic }
main            { display: flow-root; padding: 0 1ch }
h1, h2, h3, h4, h5, h6  { font-size: inherit }
table           { border-spacing: .5ch 0; margin: 0 -1ch }
figure, img     { max-width: 100%; margin: 0 }
figure          { padding: 1em 0 0 0 }
figcaption      { text-align: center }
pre         { padding-left: 1ch }
@media(grid:0){ h1  { padding: 1ch 0 0; margin: 0 }
        td, th  { padding: .3ch 1ch }
    code, pre   { font-size: 15px }     }
    /* colors */
*           { color: white }
header a        { background: #204A50 }
header a.current    { background: #192C30 }
header a:hover      { background: #192930 }
body            { background: #102527 }
main            { background: #103C40 }
main a[href]        { color: #FFC6CB }
th, td          { background: #113134 }
tr:nth-child(2n) > *    { background: #102628 }
    /* decoration */
a[href]         { text-decoration: none }
a[href]:hover       { text-decoration: underline }
header a[href]:hover    { text-decoration: none }
</style>
</head>
<body>
<center>
<header>
<a href="https://chawan.net/index.html">Index</a> <a href="https://chawan.net/news/index.html">News</a> <a href="https://chawan.net/doc/index.html">Docs</a> <a href="https://chawan.net/issues.html">Issues</a> <a href="https://sr.ht/~bptato/chawan">Source</a>
</header>
</center>
<main>
<!-- MANON
% cha-terminal(7) | Chawan terminal compatibility
MANOFF -->
<h1 id="chawan-terminal-compatibility">Chawan terminal
compatibility</h1>
<p>Chawan does not use termcap, terminfo, or ncurses; it relies solely
on built-in terminal handling routines, mostly inspired by
notcurses.</p>
<h2 id="xterm-compatibility">XTerm compatibility</h2>
<p>In general, Chawan assumes an XTerm-compatible environment where
XTerm means the current XTerm version as developed and maintained by
Thomas E. Dickey. This means that Chawan is compatible with any given
terminal if:</p>
<ul>
<li>the terminal is actually compatible with XTerm, OR</li>
<li>the terminal isn’t compatible with XTerm, but reports its
capabilities via terminal queries correctly, OR</li>
<li>the terminal isn’t compatible with XTerm, but its <code>TERM</code>
value is hardcoded in Chawan.</li>
</ul>
<p>Terminals pretending to be XTerm (<code>TERM=xterm</code>) which are
not actually XTerm might malfunction.</p>
<p>(In practice, I have tested dozens of terminal emulators and haven’t
encountered any major issues; in all likelihood, yours will work too.
Still, if it doesn’t, please <a href="https://todo.sr.ht/~bptato/chawan">open a ticket</a>.)</p>
<h2 id="queries">Queries</h2>
<p>Queries are preferred to hardcoded terminal descriptions because they
are forward-compatible. On startup, Chawan queries:</p>
<ul>
<li>Whether the terminal has true color, with XTGETTCAP rgb.</li>
<li>The default background, foreground, and 16 ANSI(-ish) colors with
<code>OSC 1 0 ; ? ST</code>, <code>OSC 1 1 ; ? ST</code>, and
<code>OSC 4 ; {0..15} ; ? ST</code>.</li>
<li>Whether the terminal can use the Kitty image protocol, by sending an
incorrectly encoded image and listening for an error.</li>
<li>The number of Sixel color registers
(<code>CSI ? 1 ; 1 ; 0 $</code>).</li>
<li>Text area, cell, and window size using <code>CSI 1 4 t</code>,
<code>CSI 1 6 t</code>, <code>CSI 1 8 t</code>. (Cell size,
<code>1 6</code>, beats the other two as it is more reliable.)</li>
<li>Primary device attributes.</li>
</ul>
<p>Primary device attributes (henceforth DA1) are queried last, and most
terminals respond to this, so Chawan should never hang on startup. If it
<em>isn’t</em> implemented (as on the FreeBSD console), the user can hit
any key to break out of the state machine and set
<code>display.query-da1 = false</code> as instructed by the browser. On
known terminals with this issue which set <code>TERM</code> correctly,
DA1 is omitted.</p>
<p>Some terminals bleed the APC sequence used to recognize kitty image
support. If the terminal also supports the alternate screen (ti/smcup),
the sequence may end up inside the shell prompt. On known terminals with
this issue which set <code>TERM</code> correctly, the kitty query is
omitted.</p>
<h2 id="ancient-terminals">Ancient terminals</h2>
<p>Pre-ECMA-48 terminals are generally not expected to work.</p>
<p>There is some degree of ADM-3A support, tested in Kragen Javier
Sitaker’s <code>admu</code> emulator. However, a real ADM-3A would
likely be confused by non-ASCII characters.</p>
<p>Patches for other terminals (hardware or software alike) are
welcome.</p>
<!-- MANON

## See also

**cha**(1)
MANOFF -->
</main>
</body></html>